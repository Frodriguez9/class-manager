# Class-Manager RESTful API

This is the backend of a project that is in progress. For a full description of
the project and API instructions, please go to the project's home page:

https://class-manager-fard.herokuapp.com/

(WARNING: The page may take a few more seconds to load than what you are
accustomed to waiting. This is because the app is deployed into Heroku's free
tier cloud service. Thank you in advance for your patience ðŸ™‚).

## Making APIs requests:

Some resources require special permission. For testing purposes, we have created
an Admin user who holds all the permissions necessary to fully use the
Class-Manager API resources. Please login with the following credentials and
follow instructions in the home page like above:


https://class-manager-fard.herokuapp.com/login

*Email address:* admin@capstone.com
*Password:* CapstoneAdmin1!

_Admin Permissions:_

delete:subjects remove course
get:students read students enrolled in a particular class
patch:subjects modify existing course
patch:subjects enroll student in a course
post:subjects create new course


## Testing Local

You can also fork this repository and clone it in your local machine.
We have created 2 set of tests with Unittest that you can quickly use to assest
the entry points with to different users. An admin that has full access to all
resources and a student assistant, who has limited access to resources.

To run these tests, go to projects directory and run:


```
$ python -m unittest
```

### ðŸ¤š But wait! let's set up you environment and dependancies first:

1. Create and activate a virtual environment for this projects

2. Clone this repository

3. Move to the project's directory and install dependancies by running:

```
pip install -r requirements.txt
```

4. Create a setup.sh file in the project's directory with the following variables
(copy/paste and complete the ones with the tag "# complete"):
```
export APP_SECRET_KEY="SuperSecretKey"

# Authentication Setup:

export AUTH_AUDIENCE="courses"
export AUTH_CALL_BACK_URL="http://127.0.0.1:5000/callback"
export AUTH_CLIENT_ID="7HMxHXT4PH7JEoAyhC9nU3kxKCEPz8ln"
export AUTH_URL="nandodev.us"

# Database:

export DATABASE_URL= # complete

# if you use PostgreSQL, your DATABASE_URL variable should look something like:
# "postgres://postgres@localhost:5432/capstone"
# Name it "capstone".
# Also, When creating your DB, create another one to be use with Unittest.
# Name it "capstone_test".

```


5. Save the setup.sh file and run:

```
$ source setup.sh
```

NOTE: You will need to activate your virtual enviroment associated with this
project and repeat step 5 everytime you open a new terminal to run the app or
run unittest

6. Migrate your models to the database by running:

```
$ flask db init
$ flask db migrate -m "initial migration"
$ flask db upgrade
```

7. Run the flask app with:

```
$ FLASK_APP=run.py FLASK_DEBUG=true flask run
```

go to your browser and verify that your app is running in

http://127.0.0.1:5000/

#### Run Unittest

8. Open a new terminal window activate the VirEnv associated with this project.
Go to the project directory and run:

```
$ python -m unittest
```

This will ran both all the test files included in the test directory.

NOTE: Make sure you are not in the project/test directory when running unittest.
This will cause a failure.

### Troubleshooting:

#### Problems with the database migration?

if you experience problems with the migration file:
go your newly created folder "migrations/versions" and in the upgrade function delete the argument:

'nullable=True' so that it looks like this:

'''
def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column('subject_student', 'student_id',
               existing_type=sa.INTEGER())
    op.alter_column('subject_student', 'subject_id',
               existing_type=sa.INTEGER())
    # ### end Alembic commands ###
'''

save the file and run again flask db upgrade


#### App is running but unittest is not recognizing the database models?

go to project/test and in every test_app....py file, change the database

from "capstone_test" to "capstone"

or whatever you named your database for the main
app. This line of code is at around line 11 and looks like this:

self.database_name = "capstone_test"
